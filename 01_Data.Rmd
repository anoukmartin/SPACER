---
title: "01_Data. Import, filtrage, enrichissement, exploration"
author: "R. Leconte"
date: "07/01/2024"
output: html_document
---

Données:

Résultats des élections présidentielles 1er tour
Millésime 2022
Echellon communal

https://www.data.gouv.fr/fr/datasets/election-presidentielle-des-10-et-24-avril-2022-resultats-definitifs-du-1er-tour/#/resources

Objectifs: 

- importer les données
- filtrage géographique des données
- mise en forme des données
- enrichissement des données
- exploration des données


```{r pkg_wd}


install.packages("openxlsx")
library(openxlsx)
library(dplyr)


```




# 1. Préparation des données
## 1.1. Chargement

```{r data}

dataURL <- "https://www.data.gouv.fr/fr/datasets/r/6d9b33e5-667d-4c3e-9a0b-5fdf5baac708"
elec <- read.xlsx(dataURL,sheet=1)
names(elec)

vars_candidats <- c("N°Panneau", "Sexe", "Nom", "Prénom", "Voix", "%.Voix/Ins", "%.Voix/Exp")
candidats <- c("ARTHAUD", "ROUSSEL", "MACRON", "LASSALLE", "LE_PEN", "ZEMMOUR", "MELENCHON", "HIDALGO", "JADOT", "PECRESSE", "POUTOU", "DUPONT-AIGNAN")

names_corr <- lapply(candidats, function(x){paste0(x, "_", vars_candidats)})
names_corr <- rbind(names_corr)

```


## 1.2. Filtrage géographique (sélection des individus)

```{r data_geofilter}

# Extraction de PACA 
unique(elec$Code.du.département)
elec_paca <- elec %>% 
  filter(Code.du.département %in% c("04", "05", "06", "13", "83", "84"))



```


# 2. Enrichissement des données

```{r data_join}

# Création du code commune

elec_idf <- elec_idf %>% 
  mutate(Code = paste(Code.du.département,Code.de.la.commune, sep=""))

# chargement de la table CSP

csp <- read.csv("CSP_idf.csv", sep = ",", header = TRUE, colClasses=c("Code"="character"))

# jointure

elec_soc_idf <- left_join(elec_idf, csp, by = "Code")


```




# 2. Exploration statistique et graphique

Quelques fonctions utiles 

```{r explor}

# Contrôler la présence de valeurs manquantes dans une variable
table(is.na(elec_soc_idf$Population.de.15.ans.ou...selon.la.CSP.2020))

# Connaitre le résumé statistique

summary(elec_soc_idf$ART_V_E)


# Observer la distribution d'une variable
# Courbe de densité
ggplot(elec_soc_idf, aes(x=ART_V_E)) + 
  geom_density()+
   scale_y_continuous(labels = scales::comma)+ # se débarasser de la notation scientifique
  # Habiller le graphique
      ylab("Densité de probabilité")+
  xlab("Part des votes exprimés ")+
  ggtitle("Résultats électoraux de N. Artaud en 2022 par commune en Ile de France")


# Boîte à moustache
ggplot(elec_soc_idf, aes(x = ART_V_E))+
  geom_boxplot()


# Graphique rang-taille

ggplot(elec_soc_idf, aes(x= reorder(Code, -ART_V_E), y = ART_V_E))+
  geom_point()+
  scale_y_log10("Votes exprimés N. Artaud", labels = scales:: comma)+
  scale_x_discrete("Rang", labels= NULL)
  



```





