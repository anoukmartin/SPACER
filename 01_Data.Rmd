---
title: "01_Data. Import, filtrage, enrichissement, exploration"
author: "R. Leconte"
date: "07/01/2024"
output: html_document
---

Données:

Résultats des élections présidentielles 1er tour
Millésime 2022
Echellon communal

https://www.data.gouv.fr/fr/datasets/election-presidentielle-des-10-et-24-avril-2022-resultats-definitifs-du-1er-tour/#/resources

Objectifs: 

- importer les données
- filtrage géographique des données
- mise en forme des données
- enrichissement des données
- exploration des données


```{r pkg_wd}

library(dplyr)
library(ggplot2)


setwd("C:/Users/romai/Documents/ens_ulm/cours/SPACER/2024/")


```




# 1. Préparation des données
## 1.1. Chargement

```{r data}
# Table des résultats
elec <- read.csv("resultats22t1.csv", sep = ";", header = TRUE, colClasses=c("Code.de.la.commune"="character"))

# Nettoyage de la table

elec <- elec %>% 
  rename(ART_V_E = X..Voix.Exp) %>% 
  select(-N.Panneau,-Sexe, -Prénom, -Nom, -Voix, -X..Voix.Ins)


```


## 1.2. Filtrage géographique (sélection des individus)

```{r data_geofilter}

# Extraction des communes faisant partie de l'IDF

elec_idf <- elec %>% 
  filter(Code.du.département %in% c("75", "77", "78", "91", "92", "93", "94", "95"))



```


# 2. Enrichissement des données

```{r data_join}

# Création du code commune

elec_idf <- elec_idf %>% 
  mutate(Code = paste(Code.du.département,Code.de.la.commune, sep=""))

# chargement de la table CSP

csp <- read.csv("CSP_idf.csv", sep = ",", header = TRUE, colClasses=c("Code"="character"))

# jointure

elec_soc_idf <- left_join(elec_idf, csp, by = "Code")


```




# 2. Exploration statistique et graphique

Quelques fonctions utiles 

```{r explor}

# Contrôler la présence de valeurs manquantes dans une variable
table(is.na(elec_soc_idf$Population.de.15.ans.ou...selon.la.CSP.2020))

# Connaitre le résumé statistique

summary(elec_soc_idf$ART_V_E)


# Observer la distribution d'une variable
# Courbe de densité
ggplot(elec_soc_idf, aes(x=ART_V_E)) + 
  geom_density()+
   scale_y_continuous(labels = scales::comma)+ # se débarasser de la notation scientifique
  # Habiller le graphique
      ylab("Densité de probabilité")+
  xlab("Part des votes exprimés ")+
  ggtitle("Résultats électoraux de N. Artaud en 2022 par commune en Ile de France")


# Boîte à moustache
ggplot(elec_soc_idf, aes(x = ART_V_E))+
  geom_boxplot()


# Graphique rang-taille

ggplot(elec_soc_idf, aes(x= reorder(Code, -ART_V_E), y = ART_V_E))+
  geom_point()+
  scale_y_log10("Votes exprimés N. Artaud", labels = scales:: comma)+
  scale_x_discrete("Rang", labels= NULL)
  



```





